## NSW Gov RAG Career System â€” Schema & Data Model

### Core Tables

#### `general_roles`

Stores generalized versions of roles across departments for grouping and transitions.

```sql
CREATE TABLE general_roles (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  title text NOT NULL,
  description text,
  classification_band text,
  family text,
  embedding vector(1536),
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### `roles`

Links specific job roles (agency/division scoped) to their general roles.

```sql
ALTER TABLE roles ADD COLUMN general_role_id uuid REFERENCES general_roles(id);
ALTER TABLE roles ADD COLUMN classification_level_id uuid REFERENCES classification_levels(id);
```

#### `classification_levels`

Used to normalize classification schemes across jurisdictions.

```sql
CREATE TABLE classification_levels (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  jurisdiction text NOT NULL,
  code text NOT NULL,
  label text,
  mapped_band text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

#### `general_role_transitions`

Captures normalized role-to-role transitions and their characteristics.

```sql
CREATE TABLE general_role_transitions (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  source_general_role_id uuid REFERENCES general_roles(id),
  target_general_role_id uuid REFERENCES general_roles(id),
  gap_score numeric,
  similarity_score numeric,
  transition_summary text,
  recommended_actions text[],
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

---

### Generated Content Caching

#### `generated_content`

Stores JSON or HTML content generated by actions to power public-facing pages.

```sql
CREATE TABLE generated_content (
  id uuid PRIMARY KEY DEFAULT uuid_generate_v4(),
  content_type text NOT NULL,      -- e.g., 'role', 'transition', 'capability'
  reference_id uuid NOT NULL,      -- points to general_role_id, etc.
  data_json jsonb,                 -- structured content blocks
  embedding vector(1536),
  generated_by text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  UNIQUE(content_type, reference_id)
);
```

---

### Embedding Indexing

All semantic objects support `embedding vector(1536)` to enable similarity search for RAG.
Applies to:

* roles
* general\_roles
* capabilities
* skills
* jobs
* profiles

---

### Classification Mapping Table

Used during general role generation to assign bands across jurisdictions.

Example:

| Jurisdiction | Code | Mapped Band | Label       |
| ------------ | ---- | ----------- | ----------- |
| NSW          | G6   | APS5/6      | Grade 6     |
| NSW          | G7   | APS5/6      | Grade 7     |
| APS          | APS6 | APS5/6      | APS Level 6 |
| QLD          | L5   | APS5        | Level 5     |
| VIC          | VPS4 | APS5/6      | VPS Grade 4 |

---

### Notes

* The database is optimized for async AI generation + fast cache reads.
* Embeddings are used for clustering, similarity, and smart recommendations.
* Data structure is schema-first but prompt-flexible.
* Role normalization allows department-specific content + whole-of-gov views.
